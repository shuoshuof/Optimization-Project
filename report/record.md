# 问题一

C066主要用了两次熵权法


## 熵权法（Entropy Weight Method, EWM） （计算方法）

**核心思想**
- **熵（Entropy）** 衡量信息的混乱程度。
- 若某指标数据**差异越大** → 信息熵越小 → 提供的信息越多 → **权重应更高**。
- 若某指标数据**几乎相同** → 信息熵越大 → 区分度低 → **权重应更低**。

### 符号说明
| 符号 | 含义 |
|------|------|
| \( n \) | 评价对象个数（如供货商数量） |
| \( m \) | 评价指标个数（如供货能力、稳定性等） |
| \( x_{ij} \) | 第 \( i \) 个对象在第 \( j \) 个指标上的原始值 |
| \( p_{ij} \) | 标准化后的值（归一化到 [0,1]） |
| \( f_{ij} \) | 第 \( i \) 个对象在指标 \( j \) 上的比重 |
| \( e_j \) | 第 \( j \) 个指标的信息熵 |
| \( d_j \) | 第 \( j \) 个指标的差异系数 |
| \( w_j \) | 第 \( j \) 个指标的权重 |


### 计算步骤

#### Step 1：数据标准化（归一化）

正向指标（越大越好）：
\[
p_{ij} = \frac{x_{ij} - \min(x_j)}{\max(x_j) - \min(x_j)}
\]

负向指标（越小越好）：
\[
p_{ij} = \frac{\max(x_j) - x_{ij}}{\max(x_j) - \min(x_j)}
\]

> 所有 \( p_{ij} \in [0, 1] \)

---

#### Step 2：计算比重（概率化）

\[
f_{ij} = \frac{p_{ij}}{\sum_{i=1}^{n} p_{ij}}
\]

> 注意：若 \( \sum p_{ij} = 0 \)，则该指标无意义，应剔除

---

### Step 3：计算信息熵

\[
e_j = -\frac{1}{\ln n} \sum_{i=1}^{n} f_{ij} \ln f_{ij}
\]

> 规定：若 \( f_{ij} = 0 \)，则 \( f_{ij} \ln f_{ij} = 0 \)

---

### Step 4：计算差异系数

\[
d_j = 1 - e_j
\]

> \( d_j \in [0, 1] \)，越大说明该指标区分度越高

---

### Step 5：计算权重

\[
w_j = \frac{d_j}{\sum_{j=1}^{m} d_j}
\]

> 所有权重之和为 1，即 \( \sum_{j=1}^{m} w_j = 1 \)

---

## 四、示例（简化）

### 原始数据（3个对象，2个指标）

| 对象 | 指标A（正向） | 指标B（负向） |
|------|----------------|----------------|
| 1    | 80             | 10             |
| 2    | 90             | 20             |
| 3    | 100            | 30             |

---

### Step 1：标准化

#### 指标A（正向）：
\[
p_{1A} = \frac{80 - 80}{100 - 80} = 0,\quad
p_{2A} = \frac{90 - 80}{20} = 0.5,\quad
p_{3A} = 1
\]

#### 指标B（负向）：
\[
p_{1B} = \frac{30 - 10}{20} = 1,\quad
p_{2B} = \frac{30 - 20}{20} = 0.5,\quad
p_{3B} = 0
\]

---

### Step 2：计算比重

#### 指标A总和 = 0 + 0.5 + 1 = 1.5

\[
f_{1A} = 0 / 1.5 = 0,\quad
f_{2A} = 0.5 / 1.5 = 0.333,\quad
f_{3A} = 1 / 1.5 = 0.667
\]

#### 指标B总和 = 1 + 0.5 + 0 = 1.5

\[
f_{1B} = 1 / 1.5 = 0.667,\quad
f_{2B} = 0.5 / 1.5 = 0.333,\quad
f_{3B} = 0
\]

---

### Step 3：计算熵值

\[
e_A = -\frac{1}{\ln 3}(0 + 0.333 \ln 0.333 + 0.667 \ln 0.667) \approx 0.918
\]

\[
e_B = -\frac{1}{\ln 3}(0.667 \ln 0.667 + 0.333 \ln 0.333 + 0) \approx 0.918
\]

---

### Step 4：差异系数

\[
d_A = 1 - 0.918 = 0.082,\quad
d_B = 1 - 0.918 = 0.082
\]

---

### Step 5：权重

\[
w_A = \frac{0.082}{0.082 + 0.082} = 0.5,\quad
w_B = 0.5
\]

---

### 总结

| 指标 | 熵值 | 差异系数 | 权重 |
|------|------|----------|--------|
| A    | 0.918 | 0.082    | 0.5    |
| B    | 0.918 | 0.082    | 0.5    |


---

## 问题1求解指标
| 指标名称        | 含义              | 类型 | 计算方式简述                     |
| ----------- | --------------- | -- | -------------------------- |
| **供货次数**    | 供货商参与供货的频次      | 能力 | 5年内供货周数总和                  |
| **平均供货量**   | 每次供货的平均能力       | 能力 | 总供货量 ÷ 供货次数（统一换算为"可生产产品量"） |
| **单次最大供货量** | 峰值供货能力          | 能力 | 历史最大一次供货量（换算后）             |
| **供货稳定性**   | 实际供货与订单的偏差程度    | 风险 | 供货量与订单量的**均方误差**           |
| **供货连续性**   | 是否持续供货，避免断供     | 风险 | 基于间隔次数、平均间隔、连续供货周数，用熵权法打分  |
| **合理供货比例**  | 供货量是否在订单±20%范围内 | 风险 | 合理供货次数 ÷ 总供货次数             |

---

## 指标计算详细过程

### 1. 数据预处理

根据题目要求，首先需要剔除极低质量供应商。通过统计每个供应商供货量与订单量的差值，识别出质量不达标的供应商。

**剔除标准：**
- 供货次数 < 70 **且** 缺货 > 100立方米的次数 ≥ 6

通过此标准，从402家供应商中剔除33家极低质量供应商，剩余**369家**供应商用于后续分析。

### 2. 材料转换系数

生产1立方米产品所需的原材料消耗量（\( p_i \)）：
- A类材料：\( p_A = 0.6 \)
- B类材料：\( p_B = 0.66 \)
- C类材料：\( p_C = 0.72 \)

### 3. 六个指标的计算公式

设供应商 \( i \) 在第 \( t \) 周的：
- 供货量：\( x_{i,t} \)
- 订货量：\( z_{i,t} \)
- 总周数：\( T = 240 \)

#### 指标1：供货次数 \( n_i \)

$$
n_i = \sum_{t=1}^{240} y_{i,t}, \quad y_{i,t} = \begin{cases} 1, & x_{i,t} > 0 \\ 0, & x_{i,t} = 0 \end{cases}
$$

即统计5年内实际参与供货的周数。

#### 指标2：平均供货量 \( m_i \)

$$
m_i = \frac{1}{n_i} \sum_{t=1}^{240} \frac{x_{i,t}}{p_i}
$$

其中 \( p_i \) 为材料转换系数。将原材料换算为可生产产品数量后，计算平均每次供货的生产能力。

#### 指标3：单次最大供货量 \( x_i^{\max} \)

$$
x_i^{\max} = \max\left\{ \frac{x_{i,t}}{p_i}, \; t=1,2,\ldots,240 \right\}
$$

历史最大一次供货量（换算为可生产产品数），反映供应商的峰值供货能力。

#### 指标4：供货稳定性 \( \delta_i \)

$$
\delta_i = \frac{1}{n_i} \sum_{t: x_{i,t}>0} (x_{i,t} - z_{i,t})^2
$$

计算供货量与订单量的均方误差（MSE）。只统计有供货的周次，\( \delta_i \) 越小表示供货越稳定。

#### 指标5：供货连续性 \( \Delta_i \)

供货连续性由三个子指标通过熵权法综合评价：

**子指标5.1：间隔次数** \( r_{i,1} \)
- 统计供货中断的次数（断供次数）
- 成本型指标（越少越好）

**子指标5.2：平均间隔周数** \( r_{i,2} \)
- 每次断供的平均持续周数
- 成本型指标（越短越好）

**子指标5.3：平均连续供货周数** \( r_{i,3} \)
- 每段连续供货的平均长度
- 效益型指标（越长越好）

**归一化处理：**
- 成本型指标：\( x_{\text{Scale}} = \frac{x_{\max} - x}{x_{\max} - x_{\min}} \)
- 效益型指标：\( x_{\text{Scale}} = \frac{x - x_{\min}}{x_{\max} - x_{\min}} \)

**熵权法计算权重：**

对归一化后的子指标 \( r_{i,j} \)（\( j=1,2,3 \)），计算权重：

1. 比重化：\( p_{ij} = \frac{r_{ij}}{\sum_{i=1}^{n} r_{ij}} \)

2. 熵值：\( e_j = -\frac{1}{\ln n} \sum_{i=1}^{n} p_{ij} \ln p_{ij} \)

3. 权重：\( w_j = \frac{1 - e_j}{\sum_{j=1}^{3} (1 - e_j)} \)

4. 综合得分：\( \Delta_i = w_1 r_{i,1} + w_2 r_{i,2} + w_3 r_{i,3} \)

**实际计算结果：**
- 间隔次数权重：约 2-5%
- 平均间隔周数权重：约 0.5-1%
- 平均连续供货周数权重：约 **94-98%**（占主导地位）

#### 指标6：合理供货比例 \( \gamma_i \)

$$
\gamma_i = \frac{\text{Count}_i}{n_i}
$$

其中：
$$
\text{Count}_i = \sum_{t: z_{i,t}>0} \mathbb{1}\{ x_{i,t} \in (0.8z_{i,t}, 1.2z_{i,t}) \}
$$

统计供货量在订单量 ±20% 合理范围内的次数占比。只统计有订单的周次。

### 4. TOPSIS综合评价

#### 步骤1：构建决策矩阵

$$
X = \begin{bmatrix}
n_1 & m_1 & x_1^{\max} & \delta_1 & \Delta_1 & \gamma_1 \\
n_2 & m_2 & x_2^{\max} & \delta_2 & \Delta_2 & \gamma_2 \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
n_{369} & m_{369} & x_{369}^{\max} & \delta_{369} & \Delta_{369} & \gamma_{369}
\end{bmatrix}
$$

#### 步骤2：归一化

使用Min-Max归一化：

$$
\tilde{x}_{ij} = \frac{x_{ij} - \min_i x_{ij}}{\max_i x_{ij} - \min_i x_{ij}}
$$

#### 步骤3：确定正负理想解

- 正理想解：\( Z^+ = (\max_i \tilde{x}_{i1}, \max_i \tilde{x}_{i2}, \ldots, \max_i \tilde{x}_{i6}) \)
- 负理想解：\( Z^- = (\min_i \tilde{x}_{i1}, \min_i \tilde{x}_{i2}, \ldots, \min_i \tilde{x}_{i6}) \)

#### 步骤4：计算权重（熵权法）

对每个指标 \( j \)：

1. 比重化：\( p_{ij} = \frac{\tilde{x}_{ij}}{\sum_{i=1}^{369} \tilde{x}_{ij}} \)

2. 熵值：\( e_j = -\frac{1}{\ln 369} \sum_{i=1}^{369} p_{ij} \ln p_{ij} \)

3. 差异系数：\( d_j = 1 - e_j \)

4. 权重：\( w_j = \frac{d_j}{\sum_{j=1}^{6} d_j} \)

**计算得到的权重结果：**

| 指标 | 权重 | 重要性 |
|------|------|--------|
| 供货次数 | 6.89% | 次要 |
| 平均供货量 | 28.31% | 很重要 |
| 单次最大供货量 | **37.50%** | **最重要** |
| 供货稳定性 | 6.63% | 次要 |
| 供货连续性 | 17.53% | 重要 |
| 合理供货比例 | 3.14% | 相对次要 |

#### 步骤5：计算距离

供应商 \( i \) 到正负理想解的加权欧氏距离：

$$
D_i^+ = \sqrt{\sum_{j=1}^{6} w_j (\tilde{x}_{ij} - z_j^+)^2}
$$

$$
D_i^- = \sqrt{\sum_{j=1}^{6} w_j (\tilde{x}_{ij} - z_j^-)^2}
$$

#### 步骤6：计算综合得分

$$
S_i = \frac{D_i^-}{D_i^+ + D_i^-}
$$

\( S_i \in [0, 1] \)，得分越高表示供应商综合质量越好。按 \( S_i \) 降序排列得到供应商排名。

---
